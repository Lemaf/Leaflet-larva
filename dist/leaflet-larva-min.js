!function(){L.larva={version:"0.1.0",getHeight:function(t){return t.offsetHeight},getWidth:function(t){return t.offsetWidth}},L.larva.handler={},L.larva.handler.Path=L.Handler.extend({includes:[L.Evented.prototype],initialize:function(t,e,a){L.setOptions(this,a),this._path=t,this._frameStyle=e}}),L.Path.addInitHook(function(){this.larva={}}),L.larva.handler.Polyline=L.larva.handler.Path.extend({options:{}}),L.larva.handler.Polygon=L.larva.handler.Polyline.extend({}),L.larva.frame={},L.larva.frame.Path=L.Layer.extend({statics:{TOP_LEFT:"tl",TOP_MIDDLE:"tm",TOP_RIGHT:"tr",MIDDLE_LEFT:"ml",MIDDLE_MIDDLE:"mm",MIDDLE_RIGHT:"mr",BOTTOM_LEFT:"bl",BOTTOM_MIDDLE:"bm",BOTTOM_RIGHT:"br"},options:{pane:"llarvaPathframe"},initialize:function(t){return t._pathFrame&&t._pathFrame instanceof L.larva.frame.Path?t._pathFrame:(t._pathFrame=this,void(this._path=t))},beforeAdd:function(t){t.getPane(this.options.pane)||t.createPane(this.options.pane)},getEvents:function(){return{zoom:this._updateFrame}},getDraggable:function(){return this._draggable},getFrameClientRect:function(){return this._el.getBoundingClientRect()},getPosition:function(){return L.DomUtil.getPosition(this._el)},hideHandle:function(){for(var t=0;t<arguments.length;t++)this._handles[arguments[t]]&&(this._handles[arguments[t]].style.display="none")},onAdd:function(){var t=this._el=L.DomUtil.create("div","llarva-pathframe",this.getPane());L.DomEvent.on(t,"mousedown",this._onStart,this),this._handles={},["tl","tm","tr","ml","mm","mr","bl","bm","br"].forEach(function(e){this._handles[e]=L.DomUtil.create("div","llarva-"+e,t),this._handles[e]._id=e,L.DomEvent.on(this._handles[e],L.Draggable.START.join(" "),this._onStart,this)},this),this._draggable=new L.Draggable(t),this._draggables={},this._updateFrame(),this._updateHandles()},onRemove:function(){var t;this._draggable&&this._draggable.disable();for(t in this._draggables)this._draggables[t].disable();L.DomEvent.off(this._el,"mousedown click",L.DomEvent.stop);for(t in this._handles)L.DomEvent.off(this._handles[t],"mousedown click",L.DomEvent.stop);L.DomUtil.remove(this._el),L.DomUtil.empty(this._el),delete this._el},setStyle:function(t){var e,a,i=this._style;for(e in this._handles)a=this._handles[e],a.style.display="block",this._draggables[e]&&(this._draggables[e].disable(),delete this._draggables[e]),t[e]&&(t[e].hide&&(a.style.display="none"),t[e].draggable&&(this._draggables[e]=new L.Draggable(a),this._draggables[e].enable(),L.DomEvent.off(a,"mousedown click",L.DomEvent.stop),this._updateDraggable(e)));i&&L.DomUtil.removeClass(this._el,i.className),L.DomUtil.addClass(this._el,t.className),this._style=t,this._updateHandles()},updateBounds:function(){this._updateFrame()},_onStart:function(t){L.DomEvent.stop(t),this.fire("drag:start",{sourceEvent:t,id:t.target._id}),L.DomEvent.on(document,L.Draggable.MOVE[t.type],this._onMove,this).on(document,L.Draggable.END[t.type],this._onEnd,this),L.DomUtil.addClass(document.body,"leaflet-dragging")},_onMove:function(t){L.DomEvent.stop(t),this.fire("drag:move",{sourceEvent:t})},_onEnd:function(t){L.DomEvent.stop(t);for(var e in L.Draggable.MOVE)L.DomEvent.off(document,L.Draggable.MOVE[e],this._onMove,this).off(document,L.Draggable.END[e],this._onEnd,this);L.DomUtil.removeClass(document.body,"leaflet-dragging"),this.fire("drag:end",{sourceEvent:t})},_updateDraggable:function(t){var e=this._handles[t],a=e.offsetLeft,i=e.offsetTop;e.style.marginLeft&&(a-=parseInt(e.style.marginLeft)),e.style.marginTop&&(i-=parseInt(e.style.marginTop)),L.extend(e.style,{left:"0px",top:"0px"}),L.DomUtil.setPosition(e,L.point(a,i))},_updateFrame:function(){var t=this._path.getBounds(),e=this._map.latLngToLayerPoint(t.getSouthEast()),a=this._map.latLngToLayerPoint(t.getNorthWest()),i=getComputedStyle(this._el);L.DomUtil.setPosition(this._el,a);var n=parseInt(i.borderLeftWidth)+parseInt(i.borderRightWidth),r=parseInt(i.borderTopWidth)+parseInt(i.borderBottomWidth);this._el.style.width=e.x-a.x-n+"px",this._el.style.height=e.y-a.y-r+"px",this.southEastPoint=e,this.northWestPoint=a},_updateHandles:function(){var t,e,a,i,n,r,s=L.larva.getWidth,o=L.larva.getHeight;e=getComputedStyle(this._el);var h={bottom:"borderBottomWidth",left:"borderLeftWidth",right:"borderRightWidth",top:"borderTopWidth"};for(var l in h)h[l]=parseInt(e[h[l]])/2;t=this._handles.br,a=-(s(t)/2)-h.right+"px",i=-(o(t)/2)-h.bottom+"px",L.extend(t.style,{right:a,bottom:i}),t=this._handles.bm,n=-(s(t)/2)+"px",i=-(o(t)/2)-h.bottom+"px",L.extend(t.style,{left:"50%","margin-left":n,bottom:i}),t=this._handles.bl,n=-(s(t)/2)-h.left+"px",i=-(o(t)/2)-h.bottom+"px",L.extend(t.style,{left:n,bottom:i}),t=this._handles.mm,n=-(s(t)/2)+"px",r=-(o(t)/2)+"px",L.extend(t.style,{top:"50%",left:"50%","margin-left":n,"margin-top":r}),t=this._handles.ml,r=-(o(t)/2)+"px",n=-(s(t)/2)-h.left+"px",L.extend(t.style,{top:"50%","margin-top":r,left:n}),t=this._handles.mr,a=-(s(t)/2)-h.right+"px",r=-(o(t)/2)+"px",L.extend(t.style,{right:a,top:"50%","margin-top":r}),t=this._handles.tr,a=-(s(t)/2)-h.right+"px",r=-(o(t)/2)-h.top+"px",L.extend(t.style,{right:a,top:r}),t=this._handles.tm,r=-(o(t)/2)-h.top+"px",n=-(s(t)/2)+"px",L.extend(t.style,{left:"50%","margin-left":n,top:r}),t=this._handles.tl,r=-(o(t)/2)-h.top+"px",n=-(s(t)/2)-h.left+"px",L.extend(t.style,{left:n,top:r})}}),L.larva.frame.path=function(t){return new L.larva.frame.Path(t)},L.Polyline.prototype.forEachLatLng||L.Polyline.include({forEachLatLng:function(t,e){var a=this.getLatLngs();a.length&&(Array.isArray(a[0])&&(a=a.reduce(function(t,e){return t.concat(e)},[])),a.forEach(t,e))}}),L.Polyline.prototype.updateBounds||L.Polyline.include({updateBounds:function(){var t=this._bounds=new L.LatLngBounds;this.forEachLatLng(function(e){t.extend(e)})}}),L.larva.frame.Style={},L.larva.frame.Style.Move={className:"llarva-pathframe-move",tl:{hide:!0},tr:{hide:!0},mm:{hide:!0},bl:{hide:!0},br:{hide:!0}},L.larva.frame.Style.Resize={className:"llarva-pathframe-resize",mm:{hide:!0}},L.larva.frame.Style.Rotate={className:"llarva-pathframe-rotate",mm:{draggable:!0}},L.larva.handler.Polyline.Resize=L.larva.handler.Polyline.extend({addHooks:function(){this._frame=L.larva.frame.path(this._path).addTo(this._path._map),this._frame.setStyle(this._frameStyle),this._frame.on("drag:start",this._onDragStart,this),this._frame.on("drag:move",this._onDragMove,this),this._frame.on("drag:end",this._onDragEnd,this)},_onDragEnd:function(){},_onDragMove:function(t){var e=t.sourceEvent.touches?t.sourceEvent.touches[0]:t.sourceEvent,a=null,i=null;if(void 0!==this._origin.screenX&&(a=(e.clientX-this._origin.screenX)/this._origin.width),void 0!==this._origin.screenY&&(i=(e.clientY-this._origin.screenY)/this._origin.height),null!==a||null!==i){null!==a&&null!==i&&t.sourceEvent.ctrlKey&&(i=a=Math.max(Math.abs(a),Math.abs(i)),this._origin.invertX&&(a=-a),this._origin.invertY&&(i=-i));var n,r;this._path.forEachLatLng(function(t){n=this._path._map.latLngToLayerPoint(t._original),null!==a&&(this._origin.invertX?n.x=this._origin.x-n.x:n.x=n.x-this._origin.x,n.x=n.x*a+this._origin.x),null!==i&&(this._origin.invertY?n.y=this._origin.y-n.y:n.y=n.y-this._origin.y,n.y=n.y*i+this._origin.y),r=this._path._map.layerPointToLatLng(n),t.lat=r.lat,t.lng=r.lng},this),this._path.updateBounds(),this._frame.updateBounds(),this._path.redraw()}},_onDragStart:function(t){this._path.forEachLatLng(function(t){t._original=t.clone()});var e=this._frame.getFrameClientRect(),a=this._origin={height:e.height,width:e.width},i=this._frame.getPosition();switch(t.id){case L.larva.frame.Path.TOP_LEFT:a.x=i.x+e.width,a.y=i.y+e.height,a.screenX=e.right,a.screenY=e.bottom,a.invertX=!0,a.invertY=!0;break;case L.larva.frame.Path.TOP_MIDDLE:a.y=i.y+e.height,a.screenY=e.bottom,a.invertY=!0;break;case L.larva.frame.Path.TOP_RIGHT:a.x=i.x,a.y=i.y+e.height,a.screenX=e.left,a.screenY=e.bottom,a.invertY=!0;break;case L.larva.frame.Path.MIDDLE_LEFT:a.x=i.x+e.width,a.screenX=e.right,a.invertX=!0;break;case L.larva.frame.Path.MIDDLE_RIGHT:a.x=i.x,a.screenX=e.left;break;case L.larva.frame.Path.BOTTOM_LEFT:a.x=i.x+e.width,a.y=i.y,a.screenX=e.right,a.screenY=e.top,a.invertX=!0;break;case L.larva.frame.Path.BOTTOM_MIDDLE:a.y=i.y,a.screenY=e.top;break;case L.larva.frame.Path.BOTTOM_RIGHT:a.x=i.x,a.y=i.y,a.screenY=e.top,a.screenX=e.left}}}),L.Polyline.addInitHook(function(){this.larva.resize=new L.larva.handler.Polyline.Resize(this,L.larva.frame.Style.Resize)}),L.larva.handler.Polyline.Move=L.larva.handler.Polyline.extend({addHooks:function(){this._frame=L.larva.frame.path(this._path).addTo(this._path._map),this._frame.setStyle(this._frameStyle),this._frame.on("drag:start",this._onDragStart,this),this._frame.on("drag:move",this._onDragMove,this),this._frame.on("drag:end",this._onDragEnd,this)},_onDragEnd:function(){},_onDragMove:function(t){var e=t.sourceEvent,a=e.touches&&e.touches[0]?e.touches[0]:e,i=0,n=0;if(void 0===this._axis?(i=a.clientX-this._startPoint.x,n=a.clientY-this._startPoint.y):"x"===this._axis?i=a.clientX-this._startPoint.x:"y"===this._axis&&(n=a.clientY-this._startPoint.y),0!==i||0!==n){var r,s,o=L.point(i,n);this._path.forEachLatLng(function(t){r=this._path._map.latLngToLayerPoint(t._original),r=r.add(o),s=this._path._map.layerPointToLatLng(r),t.lat=s.lat,t.lng=s.lng},this),this._path.updateBounds(),this._frame.updateBounds(),this._path.redraw()}},_onDragStart:function(t){this._startNorthWest=this._path.getBounds().getNorthWest();var e=t.sourceEvent,a=e.touches&&e.touches[0]?e.touches[0]:e;switch(this._startPoint=L.point(a.clientX,a.clientY),this._path.forEachLatLng(function(t){t._original=t.clone()}),t.id){case L.larva.frame.Path.TOP_MIDDLE:case L.larva.frame.Path.BOTTOM_MIDDLE:this._axis="y";break;case L.larva.frame.Path.MIDDLE_LEFT:case L.larva.frame.Path.MIDDLE_RIGHT:this._axis="x";break;default:delete this._axis}}}),L.Polyline.addInitHook(function(){this.larva.move=new L.larva.handler.Polyline.Move(this,L.larva.frame.Style.Move)})}();