!function(){L.larva={version:"0.1.0",getHeight:function(t){return t.offsetHeight},getWidth:function(t){return t.offsetWidth},getSourceEvent:function(t){return t.sourceEvent.touches?t.sourceEvent.touches[0]:t.sourceEvent}},L.larva.frame={},L.larva.frame.Rect=L.Layer.extend({statics:{TOP_LEFT:"tl",TOP_MIDDLE:"tm",TOP_RIGHT:"tr",MIDDLE_LEFT:"ml",MIDDLE_MIDDLE:"mm",MIDDLE_RIGHT:"mr",BOTTOM_LEFT:"bl",BOTTOM_MIDDLE:"bm",BOTTOM_RIGHT:"br"},options:{pane:"llarva-path-frame"},initialize:function(t){this._path=t},beforeAdd:function(t){t.getPane(this.options.pane)||t.createPane(this.options.pane)},getComputedStyle:function(t){return t?this._handles[t]?getComputedStyle(this._handles[t]):void 0:getComputedStyle(this._el)},getEvents:function(){return{zoom:this._onMapZoom}},getDraggable:function(){return this._draggable},getFrameClientRect:function(){return this._el.getBoundingClientRect()},getHandle:function(t){return this._handles[t]},getPosition:function(t){return t?L.DomUtil.getPosition(this._handles[t]):L.DomUtil.getPosition(this._el)},hideHandle:function(){for(var t=0;t<arguments.length;t++)this._handles[arguments[t]]&&(this._handles[arguments[t]].style.display="none")},onAdd:function(){var t=this._el=L.DomUtil.create("div","llarva-pathframe",this.getPane());L.DomEvent.on(t,L.Draggable.START.join(" "),this._onStart,this),this._handles={},["tl","tm","tr","ml","mm","mr","bl","bm","br"].forEach(function(e){this._handles[e]=L.DomUtil.create("div","llarva-"+e,t),this._handles[e]._id=e,L.DomEvent.on(this._handles[e],L.Draggable.START.join(" "),this._onStart,this)},this),this._draggable=new L.Draggable(t),this._draggables={},this._updateFrame(!1),this._updateHandles()},onRemove:function(){var t;this._draggable&&this._draggable.disable();for(t in this._draggables)this._draggables[t].disable();L.DomEvent.off(this._el,"mousedown click",L.DomEvent.stop);for(t in this._handles)L.DomEvent.off(this._handles[t],"mousedown click",L.DomEvent.stop);L.DomUtil.remove(this._el),L.DomUtil.empty(this._el),delete this._el},setElementStyle:function(t,e){e?(e=this._handles[e],e&&L.extend(e.style,t)):L.extend(this._el.style,t)},setStyle:function(t){var e,a,i=this._style;for(e in this._handles)a=this._handles[e],a.style.display="block",this._draggables[e]&&(this._draggables[e].disable(),delete this._draggables[e]),t[e]&&(t[e].hide&&(a.style.display="none"),t[e].draggable&&(this._draggables[e]=new L.Draggable(a),this._draggables[e].enable(),L.DomEvent.off(a,"mousedown click",L.DomEvent.stop)));i&&L.DomUtil.removeClass(this._el,i.className),L.DomUtil.addClass(this._el,t.className),this._style=t,this._updateHandles();for(e in this._draggables)this._updateDraggable(e)},updateBounds:function(){this._updateFrame(!1,Array.prototype.slice.call(arguments,0))},_onEnd:function(t){L.DomEvent.stop(t);for(var e in L.Draggable.MOVE)L.DomEvent.off(document,L.Draggable.MOVE[e],this._onMove,this).off(document,L.Draggable.END[e],this._onEnd,this);L.DomUtil.removeClass(document.body,"leaflet-dragging"),this.fire("drag:end",{sourceEvent:t})},_onMapZoom:function(){this._updateFrame(!0)},_onMove:function(t){L.DomEvent.stop(t),this.fire("drag:move",{sourceEvent:t})},_onStart:function(t){L.DomEvent.stop(t),this.fire("drag:start",{sourceEvent:t,handle:t.target._id}),L.DomEvent.on(document,L.Draggable.MOVE[t.type],this._onMove,this).on(document,L.Draggable.END[t.type],this._onEnd,this),L.DomUtil.addClass(document.body,"leaflet-dragging")},_updateDraggable:function(t){var e=this._handles[t],a=e.offsetLeft,i=e.offsetTop;e.style.marginLeft&&(a-=parseInt(e.style.marginLeft)),e.style.marginTop&&(i-=parseInt(e.style.marginTop)),L.extend(e.style,{left:"0px",top:"0px"}),L.DomUtil.setPosition(e,L.point(a,i))},_updateFrame:function(t,e){var a,i,n,o=L.DomUtil.getPosition(this._el),r=this._path.getBounds(),s=this._map.latLngToLayerPoint(r.getSouthEast()),l=this._map.latLngToLayerPoint(r.getNorthWest()),h=getComputedStyle(this._el);if(e&&e.length&&o)for(var d=0;d<e.length;d++)i=this._handles[e[d]],i&&(n=L.DomUtil.getPosition(i))&&(n=n.add(o),L.DomUtil.setPosition(i,n.subtract(l)));L.DomUtil.setPosition(this._el,l);var _,g,f=parseInt(h.borderLeftWidth)+parseInt(h.borderRightWidth),m=parseInt(h.borderTopWidth)+parseInt(h.borderBottomWidth);if(t&&(_=L.larva.getWidth(this._el),g=L.larva.getHeight(this._el)),this._el.style.width=s.x-l.x-f+"px",this._el.style.height=s.y-l.y-m+"px",t)for(a in this._handles)i=this._handles[a],n=L.DomUtil.getPosition(i),n&&L.DomUtil.setPosition(i,n.scaleBy(L.point(L.larva.getWidth(this._el)/_,L.larva.getHeight(this._el)/g)));this.southEastPoint=s,this.northWestPoint=l},_updateHandles:function(){var t,e,a,i,n,o,r=L.larva.getWidth,s=L.larva.getHeight;e=getComputedStyle(this._el);var l={bottom:"borderBottomWidth",left:"borderLeftWidth",right:"borderRightWidth",top:"borderTopWidth"};for(var h in l)l[h]=parseInt(e[l[h]])/2;t=this._handles.br,a=-(r(t)/2)-l.right+"px",i=-(s(t)/2)-l.bottom+"px",L.extend(t.style,{right:a,bottom:i}),t=this._handles.bm,n=-(r(t)/2)+"px",i=-(s(t)/2)-l.bottom+"px",L.extend(t.style,{left:"50%","margin-left":n,bottom:i}),t=this._handles.bl,n=-(r(t)/2)-l.left+"px",i=-(s(t)/2)-l.bottom+"px",L.extend(t.style,{left:n,bottom:i}),t=this._handles.mm,n=-(r(t)/2)+"px",o=-(s(t)/2)+"px",L.extend(t.style,{top:"50%",left:"50%","margin-left":n,"margin-top":o}),t=this._handles.ml,o=-(s(t)/2)+"px",n=-(r(t)/2)-l.left+"px",L.extend(t.style,{top:"50%","margin-top":o,left:n}),t=this._handles.mr,a=-(r(t)/2)-l.right+"px",o=-(s(t)/2)+"px",L.extend(t.style,{right:a,top:"50%","margin-top":o}),t=this._handles.tr,a=-(r(t)/2)-l.right+"px",o=-(s(t)/2)-l.top+"px",L.extend(t.style,{right:a,top:o}),t=this._handles.tm,o=-(s(t)/2)-l.top+"px",n=-(r(t)/2)+"px",L.extend(t.style,{left:"50%","margin-left":n,top:o}),t=this._handles.tl,o=-(s(t)/2)-l.top+"px",n=-(r(t)/2)-l.left+"px",L.extend(t.style,{left:n,top:o})}}),L.larva.frame.rect=function(t){return t&&t._rectFrame?t._rectFrame:t._rectFrame=new L.larva.frame.Rect(t)},L.larva.frame.RECT_STYLE={},L.larva.frame.RECT_STYLE.RESIZE={className:"llarva-pathframe-resize",mm:{hide:!0}},L.larva.frame.RECT_STYLE.ROTATE={className:"llarva-pathframe-rotate",tm:{hide:!0},ml:{hide:!0},mr:{hide:!0},bm:{hide:!0},mm:{draggable:!0}},L.Polyline.prototype.forEachLatLng||L.Polyline.include({forEachLatLng:function(t,e){var a=this.getLatLngs();a.length&&(Array.isArray(a[0])&&(a=a.reduce(function(t,e){return t.concat(e)},[])),a.forEach(t,e))}}),L.Polyline.prototype.updateBounds||L.Polyline.include({updateBounds:function(){var t=this._bounds=new L.LatLngBounds;this.forEachLatLng(function(e){t.extend(e)})}}),L.larva.handler={},L.larva.handler.Path=L.Handler.extend({includes:[L.Evented.prototype],initialize:function(t,e){L.setOptions(this,e),this._path=t}}),L.Path.addInitHook(function(){this.larva={}}),L.larva.handler.Polyline=L.larva.handler.Path.extend({backupLatLngs:function(){this._path.forEachLatLng(function(t){t._original=t.clone()})}}),L.larva.handler.Polyline.Transform=L.larva.handler.Polyline.extend({options:{noUpdate:[]},initialize:function(t,e,a){L.larva.handler.Polyline.prototype.initialize.call(this,t,a),this._frameStyle=e},transform:function(){var t,e,a=L.point(0,0),i=[null,a].concat(Array.prototype.slice.call(arguments,0));this._path.forEachLatLng(function(n){t=i[0]=this._path._map.latLngToLayerPoint(n._original),a.x=t.x,a.y=t.y,this.transformPoint.apply(this,i),e=this._path._map.layerPointToLatLng(a),n.lat=e.lat,n.lng=e.lng},this),this._path.updateBounds(),this._frame.updateBounds.apply(this._frame,this.options.noUpdate),this._path.redraw()},transformPoint:function(){throw new Error("Unsupported Operation!")}}),L.larva.handler.Polyline.Rotate=L.larva.handler.Polyline.Transform.extend({options:{noUpdate:[L.larva.frame.Rect.MIDDLE_MIDDLE]},addHooks:function(){this._frame=L.larva.frame.rect(this._path),this._frame.addTo(this._path._map),this._frame.setStyle(this._frameStyle),this._frame.on("drag:start",this._onStart,this)},transformPoint:function(t,e,a,i,n,o){e.x=t.x*i-t.y*a+n,e.y=t.x*a+t.y*i+o},_onEnd:function(){this._frame.off("drag:move",this._onMove,this).off("drag:end",this._onEnd,this)},_onMove:function(t){var e=L.larva.getSourceEvent(t),a=this._centerElement.getBoundingClientRect(),i=a.left+a.width/2,n=a.top+a.height/2,o=e.clientX-i,r=e.clientY-n,s=Math.sqrt(o*o+r*r),l=(this._vector.i*r-this._vector.j*o)/s,h=(this._vector.i*o+this._vector.j*r)/s,d=this._frame.getFrameClientRect(),_=this._frame.getPosition();i=i-d.left+_.x,n=n-d.top+_.y;var g=i*(1-h)+n*l,f=n*(1-h)-i*l;this.transform(l,h,g,f)},_onStart:function(t){if(t.handle&&t.handle!==L.larva.frame.Rect.MIDDLE_MIDDLE){var e=this._centerElement=this._frame.getHandle(L.larva.frame.Rect.MIDDLE_MIDDLE),a=e.getBoundingClientRect(),i=t.sourceEvent.target.getBoundingClientRect(),n=this._vector={i:i.left+i.width/2-(a.left-a.width/2),j:i.top+i.height/2-(a.top-a.height/2)};n.length=Math.sqrt(n.i*n.i+n.j*n.j),n.i=n.i/n.length,n.j=n.j/n.length,this.backupLatLngs(),this._frame.on("drag:move",this._onMove,this).on("drag:end",this._onEnd,this)}}}),L.Polyline.addInitHook(function(){this.larva.rotate=new L.larva.handler.Polyline.Rotate(this,L.larva.frame.RECT_STYLE.ROTATE)}),L.larva.handler.Polyline.Move=L.larva.handler.Polyline.Transform.extend({addHooks:function(){this._frame=L.larva.frame.rect(this._path).addTo(this._path._map),this._frame.on("drag:start",this._onStart,this),this._previousCursor=this._frame.getComputedStyle().cursor,this._frame.setElementStyle({cursor:"move"})},transformPoint:function(t,e,a,i){a&&(e.x=t.x+a),i&&(e.y=t.y+i)},_onEnd:function(){this._frame.off("drag:move",this._onMove,this).off("drag:end",this._onEnd)},_onMove:function(t){var e=L.larva.getSourceEvent(t),a=e.clientX-this._startPosition.x,i=e.clientY-this._startPosition.y;if(e.ctrlKey&&e.altKey){var n=Math.min(Math.abs(a),Math.abs(i));a=a>=0?n:-n,i=i>=0?n:-n}else e.altKey?i=null:e.ctrlKey&&(a=null);this.transform(a,i)},_onStart:function(t){if(!t.handle){this.backupLatLngs();var e=L.larva.getSourceEvent(t);this._startPosition={x:e.clientX,y:e.clientY},this._frame.on("drag:move",this._onMove,this).on("drag:end",this._onEnd,this)}}}),L.Polyline.addInitHook(function(){this.larva.move=new L.larva.handler.Polyline.Move(this)}),L.larva.handler.Polyline.Resize=L.larva.handler.Polyline.Transform.extend({addHooks:function(){this._frame=L.larva.frame.rect(this._path).addTo(this._path._map),this._frame.setStyle(this._frameStyle),this._frame.on("drag:start",this._onStart,this)},transformPoint:function(t,e,a,i){null!==a&&(e.x=this._origin.layerX+a*(t.x-this._origin.layerX)),null!==i&&(e.y=this._origin.layerY+i*(t.y-this._origin.layerY))},_onEnd:function(){this._frame.off("drag:move",this._onMove,this).off("drag:end",this._onEnd,this),delete this._origin},_onMove:function(t){var e=L.larva.getSourceEvent(t),a=null,i=null;if(void 0!==this._origin.x&&(a=(e.clientX-this._origin.x)/this._origin.width,this._origin.invertX&&(a=-a)),void 0!==this._origin.y&&(i=(e.clientY-this._origin.y)/this._origin.height,this._origin.invertY&&(i=-i)),null!==a&&null!==i&&e.ctrlKey){var n=Math.max(Math.abs(a),Math.abs(i));a=a>=0?n:-n,i=i>=0?n:-n}this.transform(a,i)},_onStart:function(t){var e=this._frame.getFrameClientRect(),a=this._frame.getPosition(),i=this._origin={height:e.height,width:e.width};switch(t.handle){case L.larva.frame.Rect.TOP_LEFT:i.x=e.right,i.y=e.bottom,i.invertX=i.invertY=!0,i.layerX=a.x+e.width,i.layerY=a.y+e.height;break;case L.larva.frame.Rect.TOP_MIDDLE:i.y=e.bottom,i.invertY=!0,i.layerY=a.y+e.height;break;case L.larva.frame.Rect.TOP_RIGHT:i.x=e.left,i.y=e.bottom,i.invertY=!0,i.layerX=a.x,i.layerY=a.y+e.height;break;case L.larva.frame.Rect.MIDDLE_LEFT:i.x=e.right,i.invertX=!0,i.layerX=a.x+e.width;break;case L.larva.frame.Rect.MIDDLE_RIGHT:i.x=e.left,i.layerX=a.x;break;case L.larva.frame.Rect.BOTTOM_LEFT:i.x=e.right,i.y=e.top,i.invertX=!0,i.layerX=a.x+e.width,i.layerY=a.y;break;case L.larva.frame.Rect.BOTTOM_MIDDLE:i.y=e.top,i.layerY=a.y;break;case L.larva.frame.Rect.BOTTOM_RIGHT:i.x=e.left,i.y=e.top,i.layerX=a.x,i.layerY=a.y;break;default:return}this.backupLatLngs(),this._frame.on("drag:move",this._onMove,this).on("drag:end",this._onEnd,this)}}),L.Polyline.addInitHook(function(){this.larva.resize=new L.larva.handler.Polyline.Resize(this,L.larva.frame.RECT_STYLE.RESIZE)})}();