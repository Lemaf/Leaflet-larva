!function(){L.larva={version:"0.1.0",getHeight:function(t){return t.offsetHeight},getWidth:function(t){return t.offsetWidth}},L.larva.handler={},L.larva.handler.Path=L.Handler.extend({includes:[L.Evented.prototype],initialize:function(t,e,a){L.setOptions(this,a),this._path=t,this._frameStyle=e}}),L.Path.addInitHook(function(){this.larva={}}),L.larva.handler.Polyline=L.larva.handler.Path.extend({options:{}}),L.larva.frame={},L.larva.frame.Path=L.Layer.extend({statics:{TOP_LEFT:"tl",TOP_MIDDLE:"tm",TOP_RIGHT:"tl",MIDDLE_LEFT:"ml",MIDDLE_MIDDLE:"mm",MIDDLE_RIGHT:"mr",BOTTOM_LEFT:"bl",BOTTOM_MIDDLE:"bm",BOTTOM_RIGHT:"br"},options:{pane:"llarvaPathframe"},initialize:function(t){return t._pathFrame&&t._pathFrame instanceof L.larva.frame.Path?t._pathFrame:(t._pathFrame=this,void(this._path=t))},beforeAdd:function(t){t.getPane(this.options.pane)||t.createPane(this.options.pane)},getEvents:function(){return{zoom:this._updateFrame}},getDraggable:function(){return this._draggable},getPosition:function(){return L.DomUtil.getPosition(this._el)},hideHandle:function(){for(var t=0;t<arguments.length;t++)this._elements[arguments[t]]&&(this._elements[arguments[t]].style.display="none")},onAdd:function(){var t=this._el=L.DomUtil.create("div","llarva-pathframe",this.getPane());L.DomEvent.on(t,"mousedown",L.DomEvent.stop),this._elements={},["tl","tm","tr","ml","mm","mr","bl","bm","br"].forEach(function(e){this._elements[e]=L.DomUtil.create("div","llarva-pathframe-"+e+" "+e,t),L.DomEvent.on(this._elements[e],"mousedown click",L.DomEvent.stop)},this),this._draggables={},this._draggable=new L.Draggable(t),this._updateFrame(),this._updateHandles()},onRemove:function(){this._draggable&&this._draggable.disable(),L.DomEvent.off(this._el,"mousedown",L.DomEvent.stop);for(var t in this._elements)L.DomEvent.off(this._elements[t],"mousedown click",L.DomEvent.stop);L.DomUtil.remove(this._el),L.DomUtil.empty(this._el),delete this._el},setStyle:function(t){var e,a,i=this._style;for(e in this._elements)a=this._elements[e],a.style.display="block",this._draggables[e]&&(this._draggables[e].disable(),delete this._draggables[e]),i&&L.DomUtil.removeClass(a,i.className+"-"+e),L.DomUtil.addClass(a,t.className+"-"+e),t[e]&&(t[e].hide&&(a.style.display="none"),t[e].draggable&&(this._draggables[e]=new L.Draggable(a),this._draggables[e].enable(),L.DomEvent.off(a,"mousedown click",L.DomEvent.stop),this._updateDraggable(e)));i&&L.DomUtil.removeClass(this._el,i.className),L.DomUtil.addClass(this._el,t.className),this._style=t},_updateDraggable:function(t){var e=this._elements[t],a=e.offsetLeft,i=e.offsetTop;e.style.marginLeft&&(a-=parseInt(e.style.marginLeft)),e.style.marginTop&&(i-=parseInt(e.style.marginTop)),L.extend(e.style,{left:"0px",top:"0px"}),L.DomUtil.setPosition(e,L.point(a,i))},_updateFrame:function(){var t=this._path.getBounds(),e=this._map.latLngToLayerPoint(t.getSouthEast()),a=this._map.latLngToLayerPoint(t.getNorthWest()),i=getComputedStyle(this._el);L.DomUtil.setPosition(this._el,a);var n=parseInt(i.borderLeftWidth)+parseInt(i.borderRightWidth),l=parseInt(i.borderTopWidth)+parseInt(i.borderBottomWidth);this._el.style.width=e.x-a.x-n+"px",this._el.style.height=e.y-a.y-l+"px",this.southEastPoint=e,this.northWestPoint=a},_updateHandles:function(){var t,e,a,i,n,l,o=L.larva.getWidth,s=L.larva.getHeight;e=getComputedStyle(this._el);var r={bottom:"borderBottomWidth",left:"borderLeftWidth",right:"borderRightWidth",top:"borderTopWidth"};for(var h in r)r[h]=parseInt(e[r[h]])/2;t=this._elements.br,a=-(o(t)/2)-r.right+"px",i=-(s(t)/2)-r.bottom+"px",L.extend(t.style,{right:a,bottom:i}),t=this._elements.bm,n=-(o(t)/2)+"px",i=-(s(t)/2)-r.bottom+"px",L.extend(t.style,{left:"50%","margin-left":n,bottom:i}),t=this._elements.bl,n=-(o(t)/2)-r.left+"px",i=-(s(t)/2)-r.bottom+"px",L.extend(t.style,{left:n,bottom:i}),t=this._elements.mm,n=-(o(t)/2)+"px",l=-(s(t)/2)+"px",L.extend(t.style,{top:"50%",left:"50%","margin-left":n,"margin-top":l}),t=this._elements.ml,l=-(s(t)/2)+"px",n=-(o(t)/2)-r.left+"px",L.extend(t.style,{top:"50%","margin-top":l,left:n}),t=this._elements.mr,a=-(o(t)/2)-r.right+"px",l=-(s(t)/2)+"px",L.extend(t.style,{right:a,top:"50%","margin-top":l}),t=this._elements.tr,a=-(o(t)/2)-r.right+"px",l=-(s(t)/2)-r.top+"px",L.extend(t.style,{right:a,top:l}),t=this._elements.tm,l=-(s(t)/2)-r.top+"px",n=-(o(t)/2)+"px",L.extend(t.style,{left:"50%","margin-left":n,top:l}),t=this._elements.tl,l=-(s(t)/2)-r.top+"px",n=-(o(t)/2)-r.left+"px",L.extend(t.style,{left:n,top:l})}}),L.larva.pathFrame=function(t){return new L.larva.frame.Path(t)},L.Polyline.prototype.forEachLatLng||L.Polyline.include({forEachLatLng:function(t,e){var a=this.getLatLngs();a.length&&(Array.isArray(a[0])&&(a=a.reduce(function(t,e){return t.concat(e)},[])),a.forEach(t,e))}}),L.larva.frame.Style={},L.larva.frame.Style.Move={className:"llarva-pathframe-move",tl:{hide:!0},tr:{hide:!0},mm:{hide:!0},bl:{hide:!0},br:{hide:!0}},L.larva.frame.Style.Resize={className:"llarva-pathframe-resize",mm:{hide:!0}},L.larva.frame.Style.Rotate={className:"llarva-pathframe-rotate",mm:{draggable:!0}},L.larva.handler.Polyline.Move=L.larva.handler.Polyline.extend({addHooks:function(){this._frame=L.larva.pathFrame(this._path).addTo(this._path._map),this._frame.setStyle(this._frameStyle)},_onDrag:function(){var t,e,a=this._path._map,i=this._frame.getPosition().subtract(this._layerProjectedPoint);this._path.forEachLatLng(function(n){t=a.latLngToLayerPoint(n._original),e=a.layerPointToLatLng(t.add(i)),n.lat=e.lat,n.lng=e.lng}),this._path.setLatLngs(this._path.getLatLngs())},_onDragEnd:function(){},_onDragStart:function(){this._layerProjectedPoint=this._path._map.latLngToLayerPoint(this._path.getBounds().getNorthWest()),this._path.forEachLatLng(function(t){t._original=t.clone()})}}),L.Polyline.addInitHook(function(){this.larva.move=new L.larva.handler.Polyline.Move(this,L.larva.frame.Style.Move)})}();