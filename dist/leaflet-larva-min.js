!function(){L.larva={version:"0.1.0",getHeight:function(t){return t.offsetHeight},getWidth:function(t){return t.offsetWidth}},L.larva.handler={},L.larva.handler.Path=L.Handler.extend({includes:[L.Evented.prototype],initialize:function(t,e){L.setOptions(this,e),this._path=t}}),L.larva.handler.Polyline=L.larva.handler.Path.extend({options:{}}),L.larva.frame={},L.larva.frame.Path=L.Layer.extend({statics:{TOP_LEFT:"tl",TOP_MIDDLE:"tm",TOP_RIGHT:"tl",MIDDLE_LEFT:"ml",MIDDLE_MIDDLE:"mm",MIDDLE_RIGHT:"mr",BOTTOM_LEFT:"bl",BOTTOM_MIDDLE:"bm",BOTTOM_RIGHT:"br"},options:{pane:"llarvaPathframe"},initialize:function(t){return t._pathFrame&&t._pathFrame instanceof L.larva.frame.Path?t._pathFrame:(t._pathFrame=this,void(this._path=t))},beforeAdd:function(t){t.getPane(this.options.pane)||t.createPane(this.options.pane)},getEvents:function(){return{zoom:this._onZoom}},getDraggable:function(){return this._draggable},getPosition:function(){return L.DomUtil.getPosition(this._el)},hideHandle:function(){for(var t=0;t<arguments.length;t++)this._elements[arguments[t]]&&(this._elements[arguments[t]].style.display="none")},onAdd:function(){var t=this._el=L.DomUtil.create("div","llarva-pathframe",this.getPane());L.DomEvent.on(t,"mousedown",L.DomEvent.stop),this._elements={tl:null,tm:null,tr:null,ml:null,mm:null,mr:null,bl:null,bm:null,br:null};for(var e in this._elements)this._elements[e]=L.DomUtil.create("div","llarva-pathframe-"+e+" "+e,t),L.DomEvent.on(this._elements[e],"mousedown click",L.DomEvent.stop);this._draggable=new L.Draggable(t),this._updateHandles(),this._onZoom()},onRemove:function(){this._draggable&&this._draggable.disable(),L.DomEvent.off(this._el,"mousedown",L.DomEvent.stop),L.DomUtil.remove(this._el),L.DomUtil.empty(this._el),delete this._el},_onZoom:function(){var t=this._path.getBounds(),e=this._map.latLngToLayerPoint(t.getSouthEast()),a=this._map.latLngToLayerPoint(t.getNorthWest()),n=getComputedStyle(this._el);L.DomUtil.setPosition(this._el,a);var i=parseInt(n.borderLeftWidth)+parseInt(n.borderRightWidth),o=parseInt(n.borderTopWidth)+parseInt(n.borderBottomWidth);this._el.style.width=e.x-a.x-i+"px",this._el.style.height=e.y-a.y-o+"px",this.southEastPoint=e,this.northWestPoint=a},_updateHandles:function(){var t,e,a,n,i,o,r=L.larva.getWidth,l=L.larva.getHeight;e=getComputedStyle(this._el);var s={bottom:"borderBottomWidth",left:"borderLeftWidth",right:"borderRightWidth",top:"borderTopWidth"};for(var h in s)s[h]=parseInt(e[s[h]])/2;t=this._elements.br,a=-(r(t)/2)-s.right+"px",n=-(l(t)/2)-s.bottom+"px",L.extend(t.style,{right:a,bottom:n}),t=this._elements.bm,i=-(r(t)/2)+"px",n=-(l(t)/2)-s.bottom+"px",L.extend(t.style,{left:"50%","margin-left":i,bottom:n}),t=this._elements.bl,i=-(r(t)/2)-s.left+"px",n=-(l(t)/2)-s.bottom+"px",L.extend(t.style,{left:i,bottom:n}),t=this._elements.mm,i=-(r(t)/2)+"px",o=-(l(t)/2)+"px",L.extend(t.style,{top:"50%",left:"50%","margin-left":i,"margin-top":o}),t=this._elements.ml,o=-(l(t)/2)+"px",i=-(r(t)/2)-s.left+"px",L.extend(t.style,{top:"50%","margin-top":o,left:i}),t=this._elements.mr,a=-(r(t)/2)-s.right+"px",o=-(l(t)/2)+"px",L.extend(t.style,{right:a,top:"50%","margin-top":o}),t=this._elements.tr,a=-(r(t)/2)-s.right+"px",o=-(l(t)/2)-s.top+"px",L.extend(t.style,{right:a,top:o}),t=this._elements.tm,o=-(l(t)/2)-s.top+"px",i=-(r(t)/2)+"px",L.extend(t.style,{left:"50%","margin-left":i,top:o}),t=this._elements.tl,o=-(l(t)/2)-s.top+"px",i=-(r(t)/2)-s.left+"px",L.extend(t.style,{left:i,top:o})}}),L.larva.pathFrame=function(t){return new L.larva.frame.Path(t)},L.Polyline.prototype.forEachLatLng||L.Polyline.include({forEachLatLng:function(t,e){var a=this.getLatLngs();a.length&&(Array.isArray(a[0])&&(a=a.reduce(function(t,e){return t.concat(e)},[])),a.forEach(t,e))}}),L.larva.handler.Polyline.Move=L.larva.handler.Polyline.extend({addHooks:function(){this._frame=L.larva.pathFrame(this._path).addTo(this._path._map),this._draggable=this._frame.getDraggable(),this._frame.hideHandle(L.larva.PathFrame.MIDDLE_MIDDLE),this._draggable.on({drag:this._onDrag,dragstart:this._onDragStart,dragend:this._onDragEnd},this),this._draggable.enable()},_onDrag:function(){var t,e,a=this._path._map,n=this._frame.getPosition().subtract(this._layerProjectedPoint);this._path.forEachLatLng(function(i){t=a.latLngToLayerPoint(i._original),e=a.layerPointToLatLng(t.add(n)),i.lat=e.lat,i.lng=e.lng}),this._path.setLatLngs(this._path.getLatLngs())},_onDragEnd:function(){},_onDragStart:function(){this._layerProjectedPoint=this._path._map.latLngToLayerPoint(this._path.getBounds().getNorthWest()),this._path.forEachLatLng(function(t){t._original=t.clone()})}}),L.Polyline.addInitHook(function(){this.larva||(this.larva={}),this.larva.move=new L.larva.handler.Polyline.Move(this)})}();